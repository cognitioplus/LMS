<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Health Paraprofessional Certification</title>
    <!-- Dynamic PWA Manifest Injection handled in JS -->
    <link id="manifest-link" rel="manifest" href="">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Poppins:wght@400;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#b425aa',
                        accent: '#c80ec9',
                        success: '#D4AF37',
                        surface: '#ffffff',
                        background: '#f7f7f7',
                        'primary-blue': '#2563eb',
                        'light-blue': '#dbeafe',
                        'accent-green': '#10b981',
                        'warning-red': '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Roboto Condensed', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif'],
                        brand: ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-primary: #b425aa;
            --color-accent: #c80ec9;
            --color-success: #D4AF37;
        }
        body {
            background-color: var(--background);
            overflow-x: hidden;
            font-family: 'Roboto Condensed', sans-serif;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-accent); }
        .gradient-bg {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        /* Mobile Navigation Bottom Bar */
        .bottom-nav-item.active { color: var(--color-primary); border-top: 3px solid var(--color-primary); }
        .cognitio-logo {
            height: 1.5rem;
            width: auto;
            object-fit: contain;
        }
        .cognitio-logo-mobile {
            height: 1.25rem;
            width: auto;
            object-fit: contain;
        }
        /* New Styles for Modules */
        .skill-table thead th {
            background-color: #f3f4f6;
            font-weight: 600;
            text-align: left;
            padding: 0.75rem 1rem;
        }
        .skill-table tbody td {
            padding: 0.75rem 1rem;
            vertical-align: top;
        }
        .skill-table a {
            text-decoration: underline;
        }
        .knowledge-check ul {
            margin-top: 0.25rem;
        }
        .knowledge-check li {
            padding: 0.25rem 0;
        }
        .module-header:focus {
            outline: none;
        }
        .accordion-content {
            padding: 0 1.5rem 1.5rem 1.5rem;
            background-color: #fff;
        }
        .arrow {
            transition: transform 0.2s ease;
        }
    </style>
</head>
<body class="font-sans text-gray-800 h-screen flex flex-col md:flex-row overflow-hidden">
    <!-- Sidebar (Desktop) -->
    <aside class="hidden md:flex flex-col w-64 gradient-bg text-white shadow-xl z-20">
        <div class="p-6">
            <div class="flex items-center space-x-2">
                <img src="https://appimize.app/assets/apps/user_1097/images/b2e254093bca_935_1097.png" alt="Cognitio+" class="cognitio-logo">
                <span class="font-brand text-2xl font-bold tracking-wider">Cognitio+</span>
            </div>
            <p class="text-xs opacity-80 mt-1">CCMHPP</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <button onclick="switchMode('course')" id="nav-course-d" class="w-full text-left px-6 py-3 hover:bg-white/10 transition flex items-center bg-white/20 border-l-4 border-white">
                <i class="fas fa-book-open w-6"></i> Course Modules
            </button>
            <button onclick="switchMode('knowledge')" id="nav-knowledge-d" class="w-full text-left px-6 py-3 hover:bg-white/10 transition flex items-center border-l-4 border-transparent">
                <i class="fas fa-users w-6"></i> Knowledge Hub
            </button>
            <button onclick="switchMode('settings')" id="nav-settings-d" class="w-full text-left px-6 py-3 hover:bg-white/10 transition flex items-center border-l-4 border-transparent">
                <i class="fas fa-cog w-6"></i> Settings
            </button>
        </nav>
        <div class="p-4 bg-black/10">
            <div id="user-status-display" class="text-sm mb-2 opacity-80">
                <i class="fas fa-circle-notch fa-spin"></i> Connecting...
            </div>
            <div id="certification-badge" class="hidden text-center bg-white/20 rounded p-2 border border-white/30">
                <i class="fas fa-certificate text-yellow-300"></i> Certified
            </div>
        </div>
    </aside>
    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col h-full relative">
        <!-- Mobile Header -->
        <header class="md:hidden gradient-bg text-white p-4 flex justify-between items-center shadow-md z-20">
            <div class="flex items-center space-x-2">
                <img src="https://appimize.app/assets/apps/user_1097/images/b2e254093bca_935_1097.png" alt="Cognitio+" class="cognitio-logo-mobile">
                <span class="font-brand font-bold text-lg">Cognitio+</span>
            </div>
            <div id="mobile-cert-status" class="text-xs font-bold bg-white/20 px-2 py-1 rounded hidden">Certified</div>
        </header>
        <!-- Dynamic View Container -->
        <div id="main-view" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-container relative">
            <!-- Loading Screen -->
            <div id="loading-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-50 z-50">
                <i class="fas fa-circle-notch fa-spin text-4xl text-primary mb-4"></i>
                <p class="font-heading text-gray-600">Loading Certification Data...</p>
            </div>
            <!-- Content will be injected here via JS -->
        </div>
        <!-- Mobile Bottom Nav -->
        <nav class="md:hidden bg-white shadow-lg border-t border-gray-200 flex justify-around items-center h-16 z-20">
            <button onclick="switchMode('course')" id="nav-course-m" class="bottom-nav-item active flex-1 h-full flex flex-col items-center justify-center text-gray-500">
                <i class="fas fa-book-open text-xl mb-1"></i>
                <span class="text-xs">Learn</span>
            </button>
            <button onclick="switchMode('knowledge')" id="nav-knowledge-m" class="bottom-nav-item flex-1 h-full flex flex-col items-center justify-center text-gray-500">
                <i class="fas fa-users text-xl mb-1"></i>
                <span class="text-xs">Hub</span>
            </button>
            <button onclick="switchMode('settings')" id="nav-settings-m" class="bottom-nav-item flex-1 h-full flex flex-col items-center justify-center text-gray-500">
                <i class="fas fa-cog text-xl mb-1"></i>
                <span class="text-xs">Settings</span>
            </button>
        </nav>
    </main>
    <!-- Firebase & App Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // --- Configuration & Global State ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        let app, db, auth;
        let currentUserId = null;
        let reflections = [];
        let userProgress = {};
        let activeMode = 'course'; // 'course', 'knowledge', 'settings'
        let expandedModule = 0; // Default open module
        let currentLesson = null; // Currently viewing lesson object

        // --- Data: Course Structure (Completed) ---
        const courseStructure = [
             {
                moduleIndex: 0,
                title: "Module 0: Orientation and Course Structure",
                lessons: [
                    { lessonId: "M0L1", title: "Course Goals, Purpose, and Philosophy (PFA)", content: `<div class="prose max-w-none"><p class="mb-4">The core purpose is to equip you with the essential knowledge, values, and practical skills to provide safe, ethical, and compassionate peer-based psychosocial support, both online and in community contexts.</p><div class="bg-purple-50 p-4 border-l-4 border-purple-600 rounded mb-4"><p class="font-heading font-bold text-lg text-primary">Your primary goal is not to diagnose, fix, or adviseâ€”but to LISTEN, HOLD SPACE, and CONNECT others to help.</p></div><h3 class="font-heading text-xl mt-6 mb-3 text-accent">The PFA Model: Psychological First Aid</h3><p class="mb-4">The entire course is built upon the practical, universal principles of Psychological First Aid (PFA). </p><ul class="list-disc ml-6 space-y-2"><li><strong>LOOK ðŸ‘€:</strong> Assess safety, basic needs, and distress cues.</li><li><strong>LISTEN ðŸ‘‚:</strong> Offer non-intrusive, compassionate listening.</li><li><strong>LINK ðŸ”—:</strong> Connect people to resources, information, and social support.</li></ul></div>` },
                    { lessonId: "M0L2", title: "Meet the Training Team and Structure Overview", content: `<div class="prose max-w-none"><p class="mb-4">Welcome from the Cognitio+ Training Team! This course is designed to be completed across nine sequential modules.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">Key Course Components</h3><ul class="list-disc ml-6 space-y-2"><li>Video Lectures (Simulated)</li><li>Reading Assignments (Contained within lessons)</li><li>Quizzes (For knowledge check)</li><li>Final Comprehensive Assessment (Certification)</li></ul></div>` }
                ]
            },
            {
                moduleIndex: 1,
                title: "Module 1: Foundational Frameworks and Your Role",
                lessons: [
                    { lessonId: "M1L1", title: "Guiding National and International Frameworks", content: `<div class="prose max-w-none"><p class="mb-4">Your role is anchored in global and local standards to ensure quality, ethical practice.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">WHO mhGAP</h3><p class="mb-4">A strategy to scale up services for mental, neurological, and substance use disorders. You are key to addressing the service gap.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">WHO QualityRights</h3><p class="mb-4">Promotes **Dignity, Recovery, and Human Rights** in all mental health service delivery.</p></div>` },
                    { lessonId: "M1L2", title: "Defining the Paraprofessional's Scope", content: `<div class="prose max-w-none"><p class="mb-4">It is critical to understand the distinction between peer support and clinical intervention. You are a **non-clinical** provider.</p><h3 class="font-heading text-xl mt-6 mb-3 text-accent">Professional Boundaries</h3><ul class="list-disc ml-6 space-y-2"><li><strong>Do NOT:</strong> Diagnose, prescribe, or offer long-term therapy.</li><li><strong>DO:</strong> Provide immediate comfort, assess immediate safety (LOOK), and facilitate referral (LINK).</li></ul></div>` }
                ]
            },
            {
                moduleIndex: 2,
                title: "Module 2: Ethical, Legal, and Digital Practice",
                lessons: [
                    { lessonId: "M2L1", title: "Confidentiality and Mandatory Reporting", content: `<div class="prose max-w-none"><p class="mb-4">The Ethical Imperative: All client information must be protected. You must maintain professional silence about all cases unless mandated by law.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">Key Legal Documents</h3><ul class="list-disc ml-6 space-y-2"><li><strong>Republic Act No. 10173 (Data Privacy Act):</strong> Strictly governs the handling of sensitive personal information.</li><li><strong>Republic Act No. 11036 (Mental Health Act):</strong> Upholds the rights of persons with mental health conditions.</li></ul></div>` },
                    { lessonId: "M2L2", title: "Digital Ethics and Online Support", content: `<div class="prose max-w-none"><p class="mb-4">Supporting clients online requires heightened caution regarding security, privacy, and informed consent.</p><div class="bg-red-50 p-4 border-l-4 border-red-500 rounded"><p class="font-bold">Avoid dual relationships (e.g., becoming friends with clients on social media).</p></div></div>` }
                ]
            },
            {
                moduleIndex: 3,
                title: "Module 3: Psychological First Aid (PFA) and Scope",
                lessons: [
                    { lessonId: "M3L1", title: "PFA Step 1: LOOK ðŸ‘€", content: `<div class="prose max-w-none"><p class="mb-4">The 'LOOK' stage involves observing, assessing, and identifying who needs help.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">Key Observation Areas</h3><ul class="list-disc ml-6 space-y-2"><li>Immediate safety risks (environment, self-harm, others).</li><li>Signs of severe distress.</li><li>Basic needs (food, water, medical).</li></ul></div>` },
                    { lessonId: "M3L2", title: "PFA Step 2: LISTEN ðŸ‘‚", content: `<div class="prose max-w-none"><p class="mb-4">Listening is not waiting for your turn to speak; it is fully receiving the other person's reality.</p><h3 class="font-heading text-xl mt-6 mb-3 text-accent">Compassionate Presence</h3><p>Be physically available, silent when necessary, and use non-verbal cues.</p></div>` },
                    { lessonId: "M3L3", title: "PFA Step 3: LINK ðŸ”—", content: `<div class="prose max-w-none"><p class="mb-4">Linking is the final PFA actionâ€”connecting the person to the next appropriate level of care.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">Resource Mapping</h3><p>Know your local and national resources for efficient referrals.</p></div>` }
                ]
            },
            {
                moduleIndex: 4,
                title: "Module 4: Core Support, Communication and Basic Coping Skills",
                lessons: [
                    { lessonId: "M4L1", title: "Core Support Skills (The LISTEN Phase)", content: `
                        <div class="prose max-w-none">
                            <p class="mb-6">Effective listening and communication form the bedrock of rapport and trust. These eight core skills guide the LISTEN phase:</p>

                            <!-- Skills Table -->
                            <div class="overflow-x-auto rounded-lg shadow-md mb-8">
                                <table class="min-w-full divide-y divide-gray-200 skill-table">
                                    <thead>
                                        <tr>
                                            <th class="rounded-tl-lg">Skill</th>
                                            <th>Purpose and Definition</th>
                                            <th class="rounded-tr-lg">Video URL</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr><td>1. Building Rapport</td><td>Establishing trust and comfort through authentic presence and non-verbal cues.</td><td><a href="https://youtu.be/TpPGddb93Kg" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>2. Showing Empathy</td><td>Connecting to the feelings and experiences of the client to communicate understanding.</td><td><a href="https://youtu.be/Jkg-1kLhTT4" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>3. Reflecting</td><td>Paraphrasing the client's statements to confirm understanding and deepen the conversation.</td><td><a href="https://youtu.be/ZhRTvXN_tJ8" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>4. Labeling Emotions</td><td>Helping the client accurately name and articulate their internal feelings.</td><td><a href="https://youtu.be/WCWtnChOdqI" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>5. Asking the Right Questions</td><td>Using open-ended questions that encourage detailed sharing and reflection.</td><td><a href="https://youtu.be/8Ow64RjY5zc" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>6. Giving No Advice</td><td>Guiding the client to their own solutions rather than telling them what to do (Non-maleficence).</td><td><a href="https://youtu.be/7OReldWvjds" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>7. Identifying Strengths</td><td>Pointing out the clientâ€™s inherent resilience and coping abilities to promote self-efficacy.</td><td><a href="https://youtu.be/znVeC6cdAVE" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                        <tr><td>8. Generative Listening</td><td>The deepest level of listening, focused on suspending judgment and co-creating new possibilities for the future.</td><td><a href="https://youtu.be/lxuYFw85hvw" target="_blank" class="text-indigo-600 hover:text-indigo-800">Watch Video</a></td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <h3 class="text-xl font-bold mb-4 text-gray-800">Lesson: Stabilizing and Resilience</h3>
                            
                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Teaching Basic Stabilizing Techniques</h4>
                            <p class="mb-3 text-gray-700">You can teach simple, evidence-based coping skills to promote immediate calmness:</p>
                            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                                <li><strong>Diaphragmatic (Belly) Breathing:</strong> Slowing the breath to engage the parasympathetic nervous system. Guidance: Inhale through the nose for 4, hold for 2, exhale through the mouth for 6.</li>
                                <li><strong>5-4-3-2-1 Grounding:</strong> A technique to shift focus away from distressing thoughts by engaging the five senses: Name 5 things you can see, 4 things you can touch, 3 things you can hear, 2 things you can smell, and 1 thing you can taste.</li>
                            </ul>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Supporting Personal Resilience</h4>
                            <p class="mb-4 text-gray-700">Introduce the Resilience Navigator as a tool to help them identify and strengthen their personal resources for coping with adversity and building long-term resilience.</p>
                            <a href="https://cognitioplus.aiwaapp.live/resilience-navigator/" target="_blank" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white font-medium text-sm rounded-full hover:bg-indigo-700 transition duration-150">
                                <i class="fas fa-external-link-alt mr-2"></i> Resilience Navigator Tool
                            </a>

                            <!-- Embedded Content -->
                            <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-bold text-blue-800 mb-2">Embedded Content</h4>
                                <p class="text-blue-700">Slide Presentation: <a href="https://www.canva.com/design/DAG4hEK0g5s/k2dXww5ZcePOt6hehkawhw/view?utm_content=DAG4hEK0g5s&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h1d83ec9b53" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">Core Support & Communication Slides</a></p>
                            </div>

                            <!-- Reflection Prompt -->
                            <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Reflection Prompt</h4>
                                <p class="text-yellow-700">In your past conversations, which of the four listening levels (Downloading, Factual, Empathic, Generative) did you use most often? How can you consciously shift toward Generative Listening in your practice?</p>
                            </div>

                            <!-- Knowledge Check -->
                            <div class="mt-8 p-6 bg-gray-100 rounded-lg knowledge-check">
                                <h4 class="text-lg font-bold mb-3 text-gray-800">Knowledge Check (2 Items)</h4>
                                
                                <div>
                                    <p class="font-medium text-gray-700 mb-2">1. The goal of Reflecting a client's statement (e.g., "It sounds like you felt betrayed by your friend") is primarily to:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Give the client advice on friendship.</li>
                                        <li class="font-semibold text-emerald-700">b) Show you are actively listening and confirming understanding. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Change the subject quickly.</li>
                                        <li>d) Share your own similar story.</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">2. When a client is experiencing a panic attack, what is the most immediate stabilizing technique a paraprofessional should teach?</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Long-term therapy goals.</li>
                                        <li class="font-semibold text-emerald-700">b) Diaphragmatic Breathing or 5-4-3-2-1 Grounding. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Advanced mathematics problems.</li>
                                        <li>d) A complex mindfulness meditation.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>` }
                ]
            },
            {
                moduleIndex: 5,
                title: "Module 5: Crisis Intervention and Safe Referral",
                lessons: [
                    { lessonId: "M5L1", title: "Crisis Intervention and Safe Referral", content: `
                        <div class="prose max-w-none">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">Lesson: Crisis Recognition and Immediate Safety</h3>
                            <p class="mb-6 text-gray-700">A crisis requires immediate linkage to professional help (Level 3 Care).</p>

                            <!-- Crisis Checklist Table -->
                            <div class="overflow-x-auto rounded-lg shadow-md mb-8">
                                <table class="min-w-full divide-y divide-gray-200 skill-table">
                                    <thead>
                                        <tr>
                                            <th class="bg-red-600 text-white rounded-tl-lg">Crisis Indicator</th>
                                            <th class="bg-red-600 text-white rounded-tr-lg">Action Protocol</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="font-medium text-red-700">Imminent Suicide Risk</td>
                                            <td>Ask directly ("Are you thinking of killing yourself?"), stay with them, and remove means of harm.</td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium">Psychotic Symptoms</td>
                                            <td>Symptoms like clear delusions (fixed false beliefs) or hallucinations (seeing/hearing things others do not).</td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium">Acute Violence/Aggression</td>
                                            <td>Imminent threat of harm to others.</td>
                                        </tr>
                                        <tr>
                                            <td class="font-medium">Severe Substance Withdrawal/Overdose</td>
                                            <td>Signs requiring immediate medical intervention.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Infographic: How it Feels to Have Stress and Anxiety</h4>
                            <a href="https://cognitioplus.aiwaapp.live/cache/media_cache/22356b88daf732624d26b953fb438ad8.jpeg" target="_blank" class="inline-block px-4 py-2 bg-red-600 text-white font-medium text-sm rounded-full hover:bg-red-700 transition duration-150 mb-8">
                                View Infographic
                            </a>

                            <h3 class="text-xl font-bold mb-4 text-gray-800">Lesson: Referral Protocols</h3>
                            
                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Safe Referrals within the Philippine System</h4>
                            <p class="mb-3 text-gray-700">Referrals must be targeted to the appropriate level of care:</p>
                            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                                <li><strong>Level 1 (Community/Primary Care):</strong> Refer to Barangay Health Workers (BHWs), Rural Health Units (RHUs), or LGU MHPSS desks for long-term basic counseling or psychoeducation.</li>
                                <li><strong>Level 2 (Specialized Care):</strong> Refer to licensed Psychologists or Psychiatrists for persistent symptoms (e.g., chronic depression) or formal assessment.</li>
                                <li class="font-semibold text-red-700"><strong>Level 3 (Tertiary/Emergency Care):</strong> Refer immediately to the National Center for Mental Health (NCMH) Crisis Hotline (1553), Hopeline PH, or a hospital Emergency Room for acute crises.</li>
                            </ul>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">The Seamless Care Process and Warm Handoff</h4>
                            <p class="mb-3 text-gray-700">To ensure ethical and effective continuity of care (Beneficence), you must master the seamless care process.</p>
                            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                                <li><strong>Seamless Care Guidebook and Infographics:</strong> These resources provide step-by-step instructions on documenting the referral, communicating the handoff to the receiving professional, and following up (Cognitio+, n.d.).</li>
                                <li><strong>The Warm Handoff:</strong> Whenever possible, conduct a warm handoff by calling the resource (e.g., a hotline) while the client is present and briefing the intake officer to ensure a smooth transition of care. This is crucial for Beneficence.</li>
                            </ul>

                            <!-- Reference Material -->
                            <div class="mt-8 p-4 bg-sky-50 border border-sky-200 rounded-lg">
                                <h4 class="font-bold text-sky-800 mb-2">Reference Material (Self-Reading)</h4>
                                <p class="text-sky-700">Cognitio+ Seamless Care Guidebook and Infographics: Review the process for documenting a crisis referral and follow-up steps.
                                    <a href="https://cognitioplus.aiwaapp.live/seamless-care" target="_blank" class="text-sky-600 hover:text-sky-800 font-medium ml-2">Guidebook</a> | 
                                    <a href="https://cognitioplus.aiwaapp.live/seamless-care-infographics" target="_blank" class="text-sky-600 hover:text-sky-800 font-medium">Infographics</a>
                                </p>
                            </div>

                            <!-- Reflection Prompt -->
                            <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Reflection Prompt</h4>
                                <p class="text-yellow-700">If you encounter a client with imminent suicide risk, what specific steps would you take in the next 10 minutes (Look, Listen, and Link), and what boundary would you need to breach?</p>
                            </div>

                            <!-- Knowledge Check -->
                            <div class="mt-8 p-6 bg-gray-100 rounded-lg knowledge-check">
                                <h4 class="text-lg font-bold mb-3 text-gray-800">Knowledge Check (3 Items)</h4>
                                
                                <div>
                                    <p class="font-medium text-gray-700 mb-2">1. Which contact should a paraprofessional prioritize when a client presents with a clear, imminent suicide plan?</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) The client's neighbor.</li>
                                        <li class="font-semibold text-emerald-700">b) The NCMH Crisis Hotline (1553) or emergency services (911). <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) A local primary school teacher.</li>
                                        <li>d) A general online forum.</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">2. The purpose of a "Warm Handoff" during a referral is to:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Make the client feel guilty for needing help.</li>
                                        <li class="font-semibold text-emerald-700">b) Increase the likelihood of follow-through by the client and ensure continuity of care. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Save the paraprofessional time.</li>
                                        <li>d) Avoid documenting the referral.</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">3. A referral to a Rural Health Unit (RHU) for ongoing basic counseling falls under which level of the Philippine care system?</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Level 3 (Tertiary/Emergency)</li>
                                        <li>b) Level 2 (Specialized)</li>
                                        <li class="font-semibold text-emerald-700">c) Level 1 (Primary/Community) <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>d) Level 0 (Self-Care)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>` }
                ]
            },
            {
                moduleIndex: 6,
                title: "Module 6: Cultural Sensitivity and Inclusive Practice",
                lessons: [
                    { lessonId: "M6L1", title: "Cultural Sensitivity and Inclusive Practice", content: `
                        <div class="prose max-w-none">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">Lesson: Cultural Competence and Humility</h3>
                            
                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Cultural Humility</h4>
                            <p class="mb-4 text-gray-700">Cultural humility is the continuous process of self-reflection and learning about a clientâ€™s cultural background without assuming expertise. It involves recognizing that your own culture shapes your support style.</p>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Key Filipino Cultural Values in MHPSS</h4>
                            <ul class="list-disc list-inside space-y-3 ml-4 text-gray-700">
                                <li><strong>Hiya (Shame/Modesty):</strong> Often prevents individuals from admitting distress or seeking help outside the family. Your response: Emphasize the confidentiality of the service.</li>
                                <li><strong>Pakikisama (Harmony/Group Solidarity):</strong> Pressure to maintain peace may lead individuals to suppress personal distress. Your response: Validate their feelings while gently empowering them to prioritize self-care (Autonomy).</li>
                                <li><strong>Family-Centered Healing:</strong> The family is the primary source of support. Your response: In non-crisis situations, explore how family can be safely included in the support process.</li>
                            </ul>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Inclusive Practice</h4>
                            <p class="mb-4 text-gray-700">Always adapt your language and approach to be inclusive of all groups, including:</p>
                            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                                <li>LGBTQIA+ individuals (e.g., using preferred pronouns).</li>
                                <li>Persons With Disabilities (PWDs).</li>
                                <li>Indigenous Communities.</li>
                                <li>Muslim communities.</li>
                            </ul>

                            <!-- Embedded Content -->
                            <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-bold text-blue-800 mb-2">Embedded Content</h4>
                                <p class="text-blue-700">Slide Presentation: <a href="https://www.canva.com/design/DAG4htSUDUE/v72-JsOfYY-kObohRljxKQ/view?utm_content=DAG4htSUDUE&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hbf69d5a7d3" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">Cultural Sensitivity Slides</a></p>
                            </div>

                            <!-- Reference Material -->
                            <div class="mt-8 p-4 bg-sky-50 border border-sky-200 rounded-lg">
                                <h4 class="font-bold text-sky-800 mb-2">Reference Material (Self-Reading)</h4>
                                <p class="text-sky-700">Local Filipino MHPSS Studies: Explore articles on how Filipino family dynamics or religious beliefs impact mental health narratives and recovery.</p>
                            </div>

                            <!-- Reflection Prompt -->
                            <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Reflection Prompt</h4>
                                <p class="text-yellow-700">How might your cultural background influence your perception of a client who expresses strong Hiya regarding their mental health? What specific action could you take to make them feel safe and respected?</p>
                            </div>

                            <!-- Knowledge Check -->
                            <div class="mt-8 p-6 bg-gray-100 rounded-lg knowledge-check">
                                <h4 class="text-lg font-bold mb-3 text-gray-800">Knowledge Check (2 Items)</h4>
                                
                                <div>
                                    <p class="font-medium text-gray-700 mb-2">1. If a client expresses concern that their mental health issue will cause Hiya (shame) to their family, the most appropriate culturally sensitive response is to:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Tell them Hiya is outdated.</li>
                                        <li class="font-semibold text-emerald-700">b) Reassure them that confidentiality is maintained and validate their family concern. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Insist they tell their family immediately.</li>
                                        <li>d) End the session.</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">2. The principle of Cultural Humility requires you to:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Master every single culture in the Philippines.</li>
                                        <li class="font-semibold text-emerald-700">b) Continuously engage in self-reflection and learning about other cultures without assuming expertise. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Treat all clients exactly the same way regardless of background.</li>
                                        <li>d) Only work with people from your own community.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>` }
                ]
            },
            {
                moduleIndex: 7,
                title: "Module 7: Self-Care and Resilience",
                lessons: [
                    { lessonId: "M7L1", title: "Paraprofessional Self-Care", content: `
                        <div class="prose max-w-none">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">Lesson: Paraprofessional Self-Care</h3>
                            
                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Paraprofessional Self-Care</h4>
                            <p class="mb-4 text-gray-700"><strong>Compassion Fatigue</strong> is the emotional and physical exhaustion experienced when repeatedly helping others in distress (Figley, 1995). It impairs your ability to provide safe and ethical support (Non-maleficence).</p>
                            <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                                <li><strong>Self-Care Dimensions:</strong> Develop sustainable habits across the Physical, Emotional, Social, and Spiritual domains.</li>
                                <li><strong>Supervision:</strong> Participate actively in peer supervision circles to process challenging cases, maintain boundaries, and obtain ethical guidance.</li>
                            </ul>

                            <h4 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Cognitio+ Digital Resilience Tools</h4>
                            <p class="mb-4 text-gray-700">Utilize these tools for ongoing self-monitoring and support:</p>
                            
                            <!-- Tools Table -->
                            <div class="overflow-x-auto rounded-lg shadow-md mb-8">
                                <table class="min-w-full divide-y divide-gray-200 skill-table">
                                    <thead>
                                        <tr>
                                            <th class="rounded-tl-lg bg-indigo-600 text-white">Tool</th>
                                            <th class="bg-indigo-600 text-white">Purpose and Use</th>
                                            <th class="rounded-tr-lg bg-indigo-600 text-white">Link</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr><td>Well-Be</td><td>Assess stress levels using heart rate variability (HRV) and other physiological indicators to understand your bodyâ€™s stress response.</td><td><a href="https://cognitioplus.aiwaapp.live/well-be/" target="_blank" class="text-indigo-600 hover:text-indigo-800">Access Tool</a></td></tr>
                                        <tr><td>Smart Emotion Tracker</td><td>Log and analyze your emotional experiences to recognize patterns and triggers over time.</td><td><a href="https://cognitioplus.aiwaapp.live/smart-emotion-tracker/" target="_blank" class="text-indigo-600 hover:text-indigo-800">Access Tool</a></td></tr>
                                        <tr><td>Habit Design Studio</td><td>A resource for designing and sustaining positive self-care habits aligned with your personal well-being goals.</td><td><a href="https://cognitioplus.aiwaapp.live/habit-design-studio" target="_blank" class="text-indigo-600 hover:text-indigo-800">Access Tool</a></td></tr>
                                        <tr><td>Oasis</td><td>Provides resources and guided exercises for mindfulness, grounding, and instant relaxation to promote calm.</td><td><a href="https://cognitioplus.aiwaapp.live/oasis" target="_blank" class="text-indigo-600 hover:text-indigo-800">Access Tool</a></td></tr>
                                        <tr><td>Resilience Navigator</td><td>A tool to help you identify and strengthen your personal resources for coping with adversity and building long-term resilience.</td><td><a href="https://cognitioplus.aiwaapp.live/resilience-navigator/" target="_blank" class="text-indigo-600 hover:text-indigo-800">Access Tool</a></td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Embedded Content & Infographics -->
                            <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-bold text-blue-800 mb-2">Embedded Content & Infographics</h4>
                                <ul class="list-disc list-inside space-y-1 ml-4 text-blue-700">
                                    <li>Video URL on Self-Care: <a href="https://youtu.be/bMh8MSV9qLU" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">Watch Video</a></li>
                                    <li>Infographic: How to Have a Good Mental Health: <a href="https://cognitioplus.aiwaapp.live/cache/media_cache/5ea1b3c335967d7e52fcdf1f794d8251.jpeg" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">View Infographic 1</a></li>
                                    <li>Infographic: Ways to Manage Your Emotions: <a href="https://cognitioplus.aiwaapp.live/cache/media_cache/3c62c28cf537ba598de69288156ca956.jpeg" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">View Infographic 2</a></li>
                                </ul>
                            </div>

                            <!-- Reference Material -->
                            <div class="mt-8 p-4 bg-sky-50 border border-sky-200 rounded-lg">
                                <h4 class="font-bold text-sky-800 mb-2">Reference Material (Self-Reading)</h4>
                                <p class="text-sky-700">Research on Compassion Fatigue and Burnout: Read the symptoms and management strategies for secondary trauma in helping professions. (Figley, 1995)</p>
                            </div>

                            <!-- Reflection Prompt -->
                            <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">Reflection Prompt</h4>
                                <p class="text-yellow-700">What are three specific, non-negotiable activities you will commit to integrating into your weekly routine to prevent burnout? Which Cognitio+ tool will you use to track your emotional well-being?</p>
                            </div>

                            <!-- Knowledge Check -->
                            <div class="mt-8 p-6 bg-gray-100 rounded-lg knowledge-check">
                                <h4 class="text-lg font-bold mb-3 text-gray-800">Knowledge Check (3 Items)</h4>
                                
                                <div>
                                    <p class="font-medium text-gray-700 mb-2">1. The ethical principle most directly violated if a paraprofessional suffers severe burnout and begins making unsafe decisions is:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Autonomy</li>
                                        <li>b) Beneficence</li>
                                        <li class="font-semibold text-emerald-700">c) Non-maleficence <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>d) Justice</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">2. Compassion Fatigue is caused by:</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Lack of technical knowledge.</li>
                                        <li class="font-semibold text-emerald-700">b) Repeated exposure to the traumatic experiences and suffering of others. <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                        <li>c) Working only 8 hours a day.</li>
                                        <li>d) Exercising too much.</li>
                                    </ul>
                                </div>

                                <div>
                                    <p class="font-medium text-gray-700 mb-2">3. Which Cognitio+ tool would you use to find a quick, guided breathing exercise during a moment of high stress?</p>
                                    <ul class="list-none space-y-1 ml-4 text-gray-600">
                                        <li>a) Habit Design Studio</li>
                                        <li>b) Smart Emotion Tracker</li>
                                        <li>c) Well-Be</li>
                                        <li class="font-semibold text-emerald-700">d) Oasis <i class="fas fa-check-circle text-emerald-600 ml-1"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>` }
                ]
            },
            {
                moduleIndex: 8,
                title: "Module 8: Practicum & Growth",
                lessons: [
                    { lessonId: "M8L1", title: "Practicum Documentation", content: `<div class="prose max-w-none"><p>Detailed, ethical documentation is required.</p></div>` },
                    { lessonId: "M8L2", title: "Professional Development", content: `<div class="prose max-w-none"><p>Specializing in populations and advanced training.</p></div>` }
                ]
            },
            {
                moduleIndex: 9,
                title: "Module 9: Certification",
                lessons: [
                    {
                        lessonId: "M9L1",
                        title: "Final Comprehensive Assessment Quiz",
                        quiz: [
                            { question: "The primary legal framework governing data privacy in the Philippines is:", options: ["RA 11036 (Mental Health Act)", "RA 10173 (Data Privacy Act)", "The PFA Model", "WHO mhGAP"], answer: 1, hint: "Deals directly with sensitive personal information." },
                            { question: "Which PFA core action is primarily focused on resource connection?", options: ["Look ðŸ‘€", "Listen ðŸ‘‚", "Link ðŸ”—", "Lead ðŸ¤"], answer: 2, hint: "Connecting people to help." },
                            { question: "The act of calling a hotline while the client is present is:", options: ["Mandatory reporting", "Empathic listening", "The Warm Handoff", "Psychosocial support"], answer: 2, hint: "Ensures seamless care transition." },
                            { question: "Why is compassion fatigue an ethical issue?", options: ["It reduces your ability to maintain professional capacity", "It is only a temporary feeling", "It ensures you are always smiling", "It is required for crisis intervention"], answer: 0, hint: "Relates to professional integrity." },
                            { question: "According to I.P.M., which factor is critical for emergency referral?", options: ["Income Level", "Plan of Action", "Past Trauma", "Level of Education"], answer: 1, hint: "Intent, Plan, Means." },
                        ]
                    },
                    { lessonId: "M9L2", title: "Certification and Renewal Requirements", content: `<div class="prose max-w-none"><p class="mb-4">Certification requires successfully passing the final assessment quiz with a score of 80% or higher.</p><h3 class="font-heading text-xl mt-6 mb-3 text-primary">Renewal Requirements</h3><ul class="list-disc ml-6 space-y-2"><li>Completion of a minimum number of Continuing Professional Development (CPD) hours.</li><li>A summary of anonymized case reflections and supervision feedback.</li></ul></div>` }
                ]
            }
        ];

        // --- PWA Generation ---
        function generatePWA() {
            // Create Manifest
            const manifest = {
                name: "Mental Health Paraprofessional Certification",
                short_name: "MHP Cert",
                start_url: ".",
                display: "standalone",
                background_color: "#f7f7f7",
                theme_color: "#b425aa",
                icons: [
                    { src: "https://appimize.app/assets/apps/user_1097/images/b2e254093bca_935_1097.png", sizes: "192x192", type: "image/png" },
                    { src: "https://appimize.app/assets/apps/user_1097/images/b2e254093bca_935_1097.png", sizes: "512x512", type: "image/png" }
                ]
            };
            const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            document.getElementById('manifest-link').href = URL.createObjectURL(manifestBlob);
            // Register Dummy SW
            if ('serviceWorker' in navigator) {
                const swContent = `self.addEventListener('fetch', e => { /* Cache logic would go here */ });`;
                const swBlob = new Blob([swContent], {type: 'application/javascript'});
                const swUrl = URL.createObjectURL(swBlob);
                navigator.serviceWorker.register(swUrl).then(() => console.log('PWA Service Worker registered')).catch(console.error);
            }
        }
        generatePWA();

        // --- UI Rendering Functions ---
        window.switchMode = (mode) => {
            activeMode = mode;
            // Update Nav Styles
            ['course', 'knowledge', 'settings'].forEach(m => {
                document.getElementById(`nav-${m}-d`).className = m === mode 
                    ? "w-full text-left px-6 py-3 hover:bg-white/10 transition flex items-center bg-white/20 border-l-4 border-white"
                    : "w-full text-left px-6 py-3 hover:bg-white/10 transition flex items-center border-l-4 border-transparent";
                document.getElementById(`nav-${m}-m`).className = m === mode
                    ? "bottom-nav-item active flex-1 h-full flex flex-col items-center justify-center text-primary"
                    : "bottom-nav-item flex-1 h-full flex flex-col items-center justify-center text-gray-500";
            });
            renderMainContent();
        }
        window.renderMainContent = () => {
            const container = document.getElementById('main-view');
            container.innerHTML = '';
            if (activeMode === 'course') {
                renderCourseView(container);
            } else if (activeMode === 'knowledge') {
                renderKnowledgeHub(container);
            } else if (activeMode === 'settings') {
                renderSettings(container);
            }
        };
        const renderCourseView = (container) => {
            if (currentLesson) {
                renderLessonContent(container);
                return;
            }
            // Dashboard Header
            const totalLessons = courseStructure.reduce((acc, m) => acc + m.lessons.length, 0);
            const completedCount = Object.values(userProgress).filter(l => l.completed).length;
            const percentage = Math.round((completedCount / totalLessons) * 100);
            const header = document.createElement('div');
            header.className = "mb-8 fade-in";
            header.innerHTML = `
                <h2 class="text-3xl font-brand font-bold text-gray-800 mb-2">Welcome Back</h2>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500">Course Progress</p>
                        <p class="text-2xl font-bold text-primary">${percentage}% Completed</p>
                    </div>
                    <div class="w-16 h-16 rounded-full border-4 border-gray-200 flex items-center justify-center relative">
                        <div class="absolute inset-0 rounded-full border-4 border-primary" style="clip-path: inset(${100 - percentage}% 0 0 0);"></div>
                        <i class="fas fa-chart-pie text-gray-300"></i>
                    </div>
                </div>
            `;
            container.appendChild(header);
            // Modules Accordion
            courseStructure.forEach(module => {
                const moduleEl = document.createElement('div');
                moduleEl.className = "mb-4 bg-white rounded-lg shadow-sm overflow-hidden fade-in";
                const isOpen = expandedModule === module.moduleIndex;
                moduleEl.innerHTML = `
                    <button onclick="toggleModule(${module.moduleIndex})" class="w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition">
                        <span class="font-heading font-semibold text-left text-gray-700">${module.title}</span>
                        <i class="fas fa-chevron-down transform transition duration-300 ${isOpen ? 'rotate-180' : ''}"></i>
                    </button>
                    <div class="${isOpen ? 'block' : 'hidden'} border-t border-gray-100">
                        ${module.lessons.map(lesson => {
                            const isDone = userProgress[lesson.lessonId]?.completed;
                            const isQuiz = !!lesson.quiz;
                            return `
                                <button onclick="selectLesson('${lesson.lessonId}')" class="w-full text-left p-4 border-b border-gray-50 hover:bg-purple-50 flex items-center justify-between group">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full ${isDone ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400'} flex items-center justify-center mr-3">
                                            <i class="fas ${isDone ? 'fa-check' : (isQuiz ? 'fa-question' : 'fa-play')} text-xs"></i>
                                        </div>
                                        <span class="text-sm font-medium ${isDone ? 'text-gray-500 line-through' : 'text-gray-700'} group-hover:text-primary transition">${lesson.title}</span>
                                    </div>
                                    <i class="fas fa-arrow-right text-gray-300 group-hover:text-primary opacity-0 group-hover:opacity-100 transition"></i>
                                </button>
                            `
                        }).join('')}
                    </div>
                `;
                container.appendChild(moduleEl);
            });
        };
        window.toggleModule = (index) => {
            expandedModule = expandedModule === index ? -1 : index;
            renderMainContent();
        };
        window.selectLesson = (lessonId) => {
            let found = null;
            courseStructure.forEach(m => {
                const l = m.lessons.find(x => x.lessonId === lessonId);
                if (l) found = l;
            });
            currentLesson = found;
            renderMainContent();
        };
        const renderLessonContent = (container) => {
            const isQuiz = !!currentLesson.quiz;
            const isCompleted = userProgress[currentLesson.lessonId]?.completed;
            container.innerHTML = `
                <div class="fade-in max-w-3xl mx-auto">
                    <button onclick="currentLesson = null; renderMainContent()" class="mb-4 text-gray-500 hover:text-primary flex items-center text-sm font-bold">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Modules
                    </button>
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div class="h-2 bg-gradient-to-r from-primary to-accent"></div>
                        <div class="p-6 md:p-8">
                            <h2 class="text-2xl md:text-3xl font-heading font-bold text-gray-800 mb-6">${currentLesson.title}</h2>
                            ${isQuiz 
                                ? renderQuizInterface(currentLesson) 
                                : currentLesson.content
                            }
                            ${!isQuiz ? `
                            <div class="mt-8 pt-6 border-t border-gray-100 flex justify-end">
                                <button onclick="markLessonComplete('${currentLesson.lessonId}')" class="${isCompleted ? 'bg-green-500 hover:bg-green-600' : 'bg-primary hover:bg-purple-700'} text-white px-6 py-3 rounded-lg font-bold shadow-md transition transform hover:scale-105 flex items-center">
                                    <i class="fas ${isCompleted ? 'fa-check-double' : 'fa-check'} mr-2"></i>
                                    ${isCompleted ? 'Completed' : 'Mark as Complete'}
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        };
        const renderQuizInterface = (lesson) => {
            const savedScore = userProgress[lesson.lessonId]?.score;
            const isPassed = savedScore >= 80;
            if (isPassed) {
                return `
                    <div class="text-center py-8">
                        <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-trophy text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-green-700 mb-2">Certification Passed!</h3>
                        <p class="text-gray-600 mb-6">You scored ${savedScore}%. You are now a certified Paraprofessional.</p>
                        <button onclick="generateCertificate()" class="bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                            <i class="fas fa-file-download mr-2"></i> View Certificate
                        </button>
                    </div>
                `;
            }
            // Render Quiz Form
            let html = `<form id="quiz-form" class="space-y-6">`;
            lesson.quiz.forEach((q, idx) => {
                html += `
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="font-bold text-gray-800 mb-3">${idx + 1}. ${q.question}</p>
                        <div class="space-y-2">
                            ${q.options.map((opt, optIdx) => `
                                <label class="flex items-center space-x-3 cursor-pointer p-2 rounded hover:bg-white transition">
                                    <input type="radio" name="q${idx}" value="${optIdx}" class="form-radio text-primary h-4 w-4">
                                    <span class="text-gray-700">${opt}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            html += `
                <div class="pt-4">
                    <button type="button" onclick="submitQuiz('${lesson.lessonId}')" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition shadow-lg">
                        Submit Assessment
                    </button>
                </div>
            </form>`;
            return html;
        };
        window.submitQuiz = async (lessonId) => {
            const lesson = courseStructure.find(m => m.lessons.some(l => l.lessonId === lessonId)).lessons.find(l => l.lessonId === lessonId);
            const form = document.getElementById('quiz-form');
            let correct = 0;
            let total = lesson.quiz.length;
            lesson.quiz.forEach((q, idx) => {
                const selected = form.querySelector(`input[name="q${idx}"]:checked`);
                if (selected && parseInt(selected.value) === q.answer) correct++;
            });
            const score = (correct / total) * 100;
            if (score >= 80) {
                alert(`Congratulations! You passed with ${score}%.`);
                await saveProgress(lessonId, true, score);
            } else {
                alert(`You scored ${score}%. You need 80% to pass. Please try again.`);
            }
            renderMainContent();
        };
        window.markLessonComplete = async (lessonId) => {
            await saveProgress(lessonId, true);
            // Auto advance
            currentLesson = null;
            renderMainContent();
        };
        // --- Knowledge Hub Rendering ---
        const renderKnowledgeHub = (container) => {
            container.innerHTML = `
                <div class="fade-in max-w-2xl mx-auto h-full flex flex-col">
                    <h2 class="text-2xl font-brand font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-users text-primary mr-2"></i> Knowledge Hub
                    </h2>
                    <!-- Post Input -->
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-gray-100">
                        <textarea id="reflection-input" placeholder="Share a reflection, insight, or question about your practice..." class="w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary resize-none h-24 text-sm"></textarea>
                        <div class="flex justify-end mt-2">
                            <button onclick="postReflection()" class="bg-accent text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-purple-600 transition">
                                <i class="fas fa-paper-plane mr-1"></i> Post
                            </button>
                        </div>
                    </div>
                    <!-- Feed -->
                    <div class="space-y-4 pb-20">
                        ${reflections.length === 0 ? '<p class="text-center text-gray-400 italic mt-8">No reflections yet. Be the first to share!</p>' : ''}
                        ${reflections.map(r => `
                            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-primary to-accent text-white flex items-center justify-center text-xs font-bold mr-2">
                                            ${r.username[0]}
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-gray-800">${r.username}</p>
                                            <p class="text-xs text-gray-400">${r.timestamp ? new Date(r.timestamp.seconds * 1000).toLocaleDateString() : 'Just now'}</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-gray-700 text-sm mb-4 leading-relaxed">${r.content}</p>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    ${r.replies && r.replies.length > 0 ? `
                                        <div class="space-y-2 mb-3">
                                            ${r.replies.map(rep => `
                                                <div class="text-xs border-l-2 border-primary pl-2">
                                                    <span class="font-bold text-gray-600">${rep.username}:</span> ${rep.text}
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    <div class="flex">
                                        <input type="text" id="reply-${r.id}" placeholder="Write a supportive reply..." class="flex-1 bg-white border border-gray-200 rounded-l-lg px-3 py-1 text-xs focus:outline-none">
                                        <button onclick="postReply('${r.id}')" class="bg-primary text-white px-3 py-1 rounded-r-lg text-xs font-bold hover:bg-purple-700">Reply</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };
        window.postReflection = async () => {
            const content = document.getElementById('reflection-input').value;
            if(!content.trim()) return;
            if (!currentUserId) { alert("Please wait for connection..."); return; }
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'reflections'), {
                    userId: currentUserId,
                    username: `Peer-${currentUserId.substring(0, 4)}`,
                    content: content,
                    timestamp: serverTimestamp(),
                    replies: []
                });
                document.getElementById('reflection-input').value = '';
            } catch (e) { console.error(e); alert("Error posting."); }
        };
        window.postReply = async (docId) => {
            const text = document.getElementById(`reply-${docId}`).value;
            if(!text.trim()) return;
            // Note: In a real app, use arrayUnion. Here we simplify for the single-file constraint/demo logic
            try {
               const r = reflections.find(x => x.id === docId);
               const newReply = { 
                   username: `Peer-${currentUserId.substring(0,4)}`, 
                   text: text, 
                   timestamp: Date.now() 
               };
               const newReplies = [...(r.replies || []), newReply];
               await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'reflections', docId), { replies: newReplies }, { merge: true });
            } catch(e) { console.error(e); }
        };
        // --- Settings Rendering ---
        const renderSettings = (container) => {
            container.innerHTML = `
                <div class="fade-in max-w-2xl mx-auto">
                    <h2 class="text-2xl font-brand font-bold text-gray-800 mb-6">Settings</h2>
                    <div class="bg-white rounded-xl shadow-sm p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-bold text-gray-700">Dark Mode</h3>
                                <p class="text-xs text-gray-500">Reduce eye strain</p>
                            </div>
                            <button class="w-12 h-6 bg-gray-200 rounded-full relative cursor-not-allowed opacity-50">
                                <div class="w-6 h-6 bg-white rounded-full shadow border border-gray-300 absolute left-0"></div>
                            </button>
                        </div>
                        <div class="flex items-center justify-between border-t border-gray-100 pt-4">
                            <div>
                                <h3 class="font-bold text-gray-700">Notifications</h3>
                                <p class="text-xs text-gray-500">Email alerts for replies</p>
                            </div>
                            <button class="w-12 h-6 bg-primary rounded-full relative">
                                <div class="w-6 h-6 bg-white rounded-full shadow border border-gray-300 absolute right-0"></div>
                            </button>
                        </div>
                        <div class="pt-6 mt-6 border-t border-gray-100">
                             <p class="text-xs text-gray-400 text-center">Version 1.0.0 | User ID: ${currentUserId}</p>
                        </div>
                    </div>
                </div>
            `;
        };
        window.generateCertificate = () => {
             const container = document.getElementById('main-view');
             const date = new Date().toLocaleDateString();
             container.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-full p-4 fade-in">
                    <div class="bg-white border-8 border-double border-primary p-10 max-w-4xl w-full text-center shadow-2xl relative">
                        <i class="fas fa-award text-6xl text-yellow-400 mb-4"></i>
                        <h1 class="font-brand text-4xl font-bold text-gray-800 mb-2">Certificate of Completion</h1>
                        <p class="text-xl text-gray-600 mb-8">This certifies that</p>
                        <h2 class="text-3xl font-heading font-bold text-primary mb-8 border-b-2 border-gray-200 inline-block px-10 pb-2">User ${currentUserId.substring(0,6)}</h2>
                        <p class="text-gray-600 mb-4">Has successfully completed the curriculum for</p>
                        <h3 class="text-2xl font-bold text-gray-800 mb-8">Mental Health Paraprofessional Certification</h3>
                        <div class="flex justify-between items-end mt-12 text-sm text-gray-500">
                            <div class="text-left">
                                <p class="border-t border-gray-400 px-4 pt-1">Cognitio+ Training Team</p>
                            </div>
                            <div class="text-right">
                                <p class="border-t border-gray-400 px-4 pt-1">Date: ${date}</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="renderMainContent()" class="mt-8 text-gray-500 underline">Back to App</button>
                </div>
             `;
        };
        // --- Firebase Core Logic ---
        const initFirebase = async () => {
            if (!firebaseConfig) { 
                console.error("Config missing"); 
                document.getElementById('loading-screen').innerHTML = "Error: Configuration Missing";
                return; 
            }
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                else await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        document.getElementById('user-status-display').textContent = `ID: ${user.uid.substring(0,6)}...`;
                        document.getElementById('loading-screen').classList.add('hidden');
                        // Load User Progress
                        onSnapshot(doc(db, 'artifacts', appId, 'users', currentUserId, 'userState', 'progress'), (snap) => {
                            if(snap.exists()) {
                                userProgress = snap.data().lessons || {};
                                // Check certification status
                                const m9Score = userProgress['M9L1']?.score || 0;
                                if(m9Score >= 80) {
                                    document.getElementById('certification-badge').classList.remove('hidden');
                                    document.getElementById('mobile-cert-status').classList.remove('hidden');
                                }
                            }
                            renderMainContent(); // Re-render on update
                        });
                        // Load Public Reflections
                        onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'reflections'), (snap) => {
                            reflections = snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                            if(activeMode === 'knowledge') renderKnowledgeHub(document.getElementById('main-view'));
                        });
                    }
                });
            } catch (err) {
                console.error(err);
                document.getElementById('loading-screen').innerHTML = "Connection Failed.";
            }
        };
        const saveProgress = async (lessonId, completed, score = null) => {
             if(!currentUserId) return;
             const updateData = {
                 [`lessons.${lessonId}`]: { completed: true, score: score || 0 },
                 lastUpdated: serverTimestamp()
             };
             await setDoc(doc(db, 'artifacts', appId, 'users', currentUserId, 'userState', 'progress'), updateData, { merge: true });
        };
        // Start
        initFirebase();
    </script>
</body>
</html>
